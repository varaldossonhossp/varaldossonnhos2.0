<!-- ============================================================
 üíô VARAL DOS SONHOS ‚Äî configuracao-site.html (VERS√ÉO FINAL)
 ------------------------------------------------------------
 P√°gina centralizada no padr√£o do painel:
  ‚úî Carrega automaticamente as configs
  ‚úî Exibe em modo leitura
  ‚úî Bot√£o EDITAR habilita os campos
  ‚úî Bot√£o SALVAR atualiza tudo
  ‚úî Estilo igual √† p√°gina de Cartinhas
============================================================ -->

<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>‚öôÔ∏è Configura√ß√£o Geral do Site</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="../imagens/favicon.png" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet"/>

  <style>
    body {
      background-color: #f2f7fc;
      font-family: "Poppins", sans-serif;
    }
    .btn-top {
      display: inline-flex;
      gap: 8px;
      background: #1e88e5;
      color: white;
      margin-bottom: 20px;
      padding: 10px 18px;
      border-radius: 8px;
      font-weight: 600;
      text-decoration: none;
      transition: .3s;
      box-shadow: 0 2px 5px rgba(0,0,0,.1);
      align-items: center;
    }
    .btn-top:hover { background:#1565c0; transform: translateY(-2px); }

    .card-box {
      background:white;
      border-radius:20px;
      padding:2rem;
      border:1px solid #cfe3ff;
      box-shadow:0 3px 8px rgba(0,0,0,.08);
    }
    label {
      font-weight:600;
      color:#003f7d;
    }
    input, textarea {
      border:1px solid #d0d7e2;
      margin-top:4px;
      font-size:0.9rem;
    }
    input:disabled, textarea:disabled {
      background:#e8eef7;
    }
  </style>
</head>

<body class="min-h-screen">

  <!-- ============================ -->
  <!--     CONTAINER PRINCIPAL     -->
  <!-- ============================ -->
  <main class="max-w-4xl mx-auto p-6 space-y-8">

    <!-- Bot√£o voltar padr√£o -->
    <a href="admin.html" class="btn-top">
      ‚¨ÖÔ∏è <span>Voltar</span>
    </a>

    <h2 class="text-3xl font-extrabold text-blue-800 text-center">
      ‚öôÔ∏è Configura√ß√£o Geral do Site
    </h2>

    <p id="status" class="text-blue-700 text-center font-semibold mb-3">
      ‚è≥ Carregando dados...
    </p>

    <!-- ==== CARD PRINCIPAL ==== -->
    <section class="card-box">

      <form class="grid grid-cols-1 gap-6" id="form-config">

        <!-- NOME ONG -->
        <div>
          <label>Nome da ONG</label>
          <input id="nome_ong" class="w-full p-3 rounded-lg" disabled />
        </div>

        <!-- DESCRI√á√ÉO -->
        <div>
          <label>Descri√ß√£o da Homepage</label>
          <textarea id="descricao_homepage" rows="3" class="w-full p-3 rounded-lg" disabled></textarea>
        </div>

        <!-- LOGO + NUVEM -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

          <div>
            <label>üñº Logotipo da ONG</label>
            <div id="previewLogo" class="my-2"></div>
            <input type="file" id="logoUpload" class="hidden" />
          </div>

          <div>
            <label>‚òÅÔ∏è Nuvem Rodap√©</label>
            <div id="previewNuvem" class="my-2"></div>
            <input type="file" id="nuvemUpload" class="hidden" />
          </div>

        </div>

        <!-- Instagram -->
        <div>
          <label>üì± Instagram</label>
          <input id="instagram_url" class="w-full p-3 rounded-lg" disabled />
        </div>

        <!-- Email -->
        <div>
          <label>üìß E-mail de Contato</label>
          <input id="email_contato" class="w-full p-3 rounded-lg" disabled />
        </div>

        <!-- Telefone -->
        <div>
          <label>üìû Telefone de Contato</label>
          <input id="telefone_contato" class="w-full p-3 rounded-lg" disabled />
        </div>

        <!-- BOT√ïES -->
        <div class="flex justify-center gap-4 mt-4">
          <button id="btnEditar" type="button"
                  class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg shadow-md flex items-center gap-2">
            ‚úèÔ∏è <span>Editar</span>
          </button>

          <button id="btnSalvar" type="button"
                  class="bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-lg shadow-md flex items-center gap-2 hidden">
            üíæ <span>Salvar Altera√ß√µes</span>
          </button>
        </div>

      </form>

    </section>

  </main>


<script>
const TOKEN = "varaladmin";
const CLOUD_NAME = "drnn5zmxi";
const PRESET = "unsigned_uploads";
let recordId = null;

// =============== UPLOAD CLOUDINARY =======================
async function uploadImagem(file){
  const fd = new FormData();
  fd.append("file", file);
  fd.append("upload_preset", PRESET);

  const r = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, {
    method:"POST", body:fd
  });
  return (await r.json()).secure_url;
}

// =============== CARREGAR CONFIG ==========================
async function carregarConfig(){
  const r = await fetch("/api/admin?tipo=config_site");
  const json = await r.json();

  if (!json.config) {
    document.getElementById("status").textContent = "Nenhuma configura√ß√£o cadastrada.";
    return;
  }

  document.getElementById("status").textContent = "";

  const cfg = json.config;
  recordId = cfg.id;

  nome_ong.value = cfg.nome_ong || "";
  descricao_homepage.value = cfg.descricao_homepage || "";
  instagram_url.value = cfg.instagram_url || "";
  email_contato.value = cfg.email_contato || "";
  telefone_contato.value = cfg.telefone_contato || "";

  if (cfg.logo_header)
    previewLogo.innerHTML = `<img src="${cfg.logo_header}" width="150">`;

  if (cfg.nuvem_footer)
    previewNuvem.innerHTML = `<img src="${cfg.nuvem_footer}" width="180">`;
}

carregarConfig();

// =============== HABILITAR EDI√á√ÉO ========================
btnEditar.onclick = () => {
  document.querySelectorAll("input, textarea")
    .forEach(el => el.disabled = false);

  logoUpload.classList.remove("hidden");
  nuvemUpload.classList.remove("hidden");

  btnEditar.classList.add("hidden");
  btnSalvar.classList.remove("hidden");
};

// =============== SALVAR ALTERA√á√ïES ========================
btnSalvar.onclick = async () => {
  let logoUrl = null;
  let nuvemUrl = null;

  if (logoUpload.files[0]) logoUrl = await uploadImagem(logoUpload.files[0]);
  if (nuvemUpload.files[0]) nuvemUrl = await uploadImagem(nuvemUpload.files[0]);

  const fields = {
    nome_ong: nome_ong.value,
    descricao_homepage: descricao_homepage.value,
    instagram_url: instagram_url.value,
    email_contato: email_contato.value,
    telefone_contato: telefone_contato.value,
    updated_at: new Date().toISOString()
  };

  if (logoUrl) fields.logo_header = logoUrl;
  if (nuvemUrl) fields.nuvem_footer = nuvemUrl;

  await fetch("/api/admin", {
    method:"POST",
    headers:{ "Content-Type":"application/json", "x-admin-token":TOKEN },
    body: JSON.stringify({
      acao:"salvar_config_site",
      campo:"update",
      valor:fields,
      id:recordId
    })
  });

  alert("Configura√ß√µes atualizadas!");
  location.reload();
};
</script>

</body>
</html>
