<!-- //---------------------------------------------
// ğŸ’™ VARAL DOS SONHOS â€” pages/logistica-admin.html
// ------------------------------------------------------------
// PÃ¡gina do painel administrativo para gerenciar a logÃ­stica
// das doaÃ§Ãµes: confirmaÃ§Ã£o de adoÃ§Ãµes e envio de e-mails.
//     Painel para gerenciar a logÃ­stica das doaÃ§Ãµes:
//     â€¢ Aguardando confirmaÃ§Ã£o
//     â€¢ Aguardando receber
//     â€¢ Aguardando coletar
//=========================================================== -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ“¦ LogÃ­stica das DoaÃ§Ãµes | Varal dos Sonhos</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonte padrÃ£o -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="icon" href="../imagens/favicon.png" />

  <style>
    body { font-family: "Poppins", sans-serif; background:#e3f2fd; }

    /* Sidebar exclusiva da logÃ­stica */
    .sidebar {
      width: 270px;
      background: #1565c0;
      color: white;
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      padding: 20px 0;
      box-shadow: 3px 0px 10px rgba(0,0,0,0.15);
    }

    .sidebar h2 {
      padding-left: 28px;
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 30px;
    }

    .sidebar a {
      display: block;
      padding: 14px 30px;
      margin: 4px 0;
      text-decoration: none;
      color: white;
      font-weight: 500;
      transition: .2s;
    }
    .sidebar a:hover {
      background: #1e88e5;
      padding-left: 40px;
    }

    /* Ãrea da direita */
    .content {
      margin-left: 290px;
      padding: 40px;
    }

    .card {
      background: white;
      padding: 25px;
      border-radius: 18px;
      margin-bottom: 40px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }

    .card-item {
      background:white;
      border-radius: 14px;
      padding: 20px;
      border: 1px solid #d0e2ff;
      margin-bottom: 16px;
    }

    .tag{
      background:#e3f2fd;
      padding:4px 10px;
      border-radius:8px;
      font-size:13px;
      margin-right:4px;
      color:#0d47a1;
    }

    .btn-blue{
      background:#1e88e5;color:white;padding:10px 16px;border-radius:10px;
      font-weight:600;
    }
    .btn-green{
      background:#2e7d32;color:white;padding:10px 16px;border-radius:10px;
      font-weight:600;
    }
    .btn-orange{
      background:#ef6c00;color:white;padding:10px 16px;border-radius:10px;
      font-weight:600;
    }
  </style>
</head>

<body>

<!-- ==========================================================
     ğŸ“Œ SIDEBAR EXCLUSIVA DA LOGÃSTICA
=========================================================== -->
<aside class="sidebar">
  <h2>ğŸ“¦ LogÃ­stica</h2>

  <a href="#sec-pendentes">â³ Aguardando ConfirmaÃ§Ã£o</a>
  <a href="#sec-confirmadas">ğŸ“¬ Aguardando Receber</a>
  <a href="#sec-coletar">ğŸšš Aguardando Coletar</a>

  <hr class="my-6 border-white/40">

  <a href="admin.html">â¬…ï¸ Voltar ao Painel Admin</a>
  <a href="../index.html">ğŸ  Voltar ao Site</a>
</aside>


<!-- ==========================================================
     ğŸ“Œ CONTEÃšDO PRINCIPAL
=========================================================== -->
<main class="content">

  <h1 class="text-3xl font-bold text-blue-800 mb-6">
    ğŸ“¦ LogÃ­stica das DoaÃ§Ãµes
  </h1>

  <!-- ======================================================
       1 â€” AGUARDANDO CONFIRMAÃ‡ÃƒO
  ====================================================== -->
  <section id="sec-pendentes" class="card">
    <h2 class="text-2xl font-bold text-blue-600 mb-4">â³ Aguardando ConfirmaÃ§Ã£o</h2>
    <div id="cardsPendentes"></div>
  </section>

  <!-- ======================================================
       2 â€” AGUARDANDO RECEBER
  ====================================================== -->
  <section id="sec-confirmadas" class="card">
    <h2 class="text-2xl font-bold text-green-700 mb-4">ğŸ“¬ Aguardando Receber</h2>
    <div id="cardsConfirmadas"></div>
  </section>

  <!-- ======================================================
       3 â€” AGUARDANDO COLETAR
  ====================================================== -->
  <section id="sec-coletar" class="card">
    <h2 class="text-2xl font-bold text-orange-700 mb-4">ğŸšš Aguardando Coletar</h2>
    <div id="cardsColetar"></div>
  </section>

</main>

<!-- ==========================================================
     SCRIPT DE LÃ“GICA
=========================================================== -->
<script src="../js/config-site-apply.js"></script>

<script>

async function carregarAdoacoes(){
  const c1 = document.getElementById("cardsPendentes");
  const c2 = document.getElementById("cardsConfirmadas");
  const c3 = document.getElementById("cardsColetar");

  c1.innerHTML = c2.innerHTML = c3.innerHTML = "<p>Carregando...</p>";

  const r = await fetch("/api/listAdocoes");
  const { sucesso, adocoes } = await r.json();

  if(!sucesso){ alert("Erro ao carregar adoÃ§Ãµes."); return; }

  const pendentes  = adocoes.filter(a => a.status_adocao === "aguardando confirmacao");
  const confirmadas = adocoes.filter(a => a.status_adocao === "confirmada");
  const coletar     = adocoes.filter(a => a.status_adocao === "presente recebido");

  // -------- PENDENTES --------
  c1.innerHTML = pendentes.length ? "" : "<p class='text-gray-600'>Nenhuma adoÃ§Ã£o pendente.</p>";
  pendentes.forEach(a=>{
    c1.innerHTML += `
      <div class="card-item">
        <p class="font-bold text-lg">${a.nome_crianca}</p>
        <p class="text-gray-600 text-sm">ğŸ ${a.sonho}</p>

        <div class="mt-2">
          <span class="tag">ğŸ†” Cartinha: ${a.id_cartinha}</span>
          <span class="tag">ğŸ‘¤ ${a.nome_usuario}</span>
        </div>

        <button class="btn-blue mt-4" onclick="confirmarAdocao('${a.id_record}')">
          âœ” Confirmar
        </button>
      </div>
    `;
  });

  // -------- CONFIRMADAS --------
  c2.innerHTML = confirmadas.length ? "" : "<p class='text-gray-600'>Nenhuma adoÃ§Ã£o confirmada.</p>";
  confirmadas.forEach(a=>{
    c2.innerHTML += `
      <div class="card-item">
        <p class="font-bold text-lg">${a.nome_crianca}</p>
        <p class="text-gray-600 text-sm">ğŸ ${a.sonho}</p>

        <div class="mt-2">
          <span class="tag">ğŸ†” Cartinha: ${a.id_cartinha}</span>
          <span class="tag">ğŸ“¦ Ponto: ${a.nome_ponto || "â€”"}</span>
        </div>

        <button class="btn-green mt-4"
          onclick="receberPresente('${a.id_record}', '${a.id_ponto}')">
          ğŸ“¦ Recebido
        </button>
      </div>
    `;
  });

  // -------- COLETAR --------
  c3.innerHTML = coletar.length ? "" : "<p class='text-gray-600'>Nenhum presente aguardando coleta.</p>";
  coletar.forEach(a=>{
    c3.innerHTML += `
      <div class="card-item">
        <p class="font-bold text-lg">${a.nome_crianca}</p>
        <p class="text-gray-600 text-sm">ğŸ ${a.sonho}</p>

        <div class="mt-2">
          <span class="tag">ğŸ†” Cartinha: ${a.id_cartinha}</span>
          <span class="tag">ğŸ“¦ Ponto: ${a.nome_ponto || "â€”"}</span>
        </div>

        <button class="btn-orange mt-4"
          onclick="coletarPresente('${a.id_record}', '${a.id_ponto}')">
          ğŸšš Coletado
        </button>
      </div>
    `;
  });

}



// ==========================================================
// âœ” CONFIRMAR ADOÃ‡ÃƒO
// ==========================================================
async function confirmarAdocao(id){
  if(!confirm("Confirmar adoÃ§Ã£o?")) return;

  const r = await fetch("/api/confirmar?id_adocao="+id);

  if(r.ok){
    alert("AdoÃ§Ã£o confirmada!");
    carregarAdoacoes();
  } else {
    alert("Erro ao confirmar.");
  }
}



// ==========================================================
// âœ” RECEBER PRESENTE (PONTO)
// ==========================================================
async function receberPresente(idAdocao){
  if(!confirm("Confirmar que o presente foi RECEBIDO no ponto?")) return;

  const r = await fetch("/api/logistica", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      acao:"receber",
      id_registro:idAdocao,     
      responsavel:"Admin",
      observacoes:""
    })
  });

  const json = await r.json();

  if(json.sucesso){
    alert("Presente marcado como RECEBIDO!");
    carregarAdoacoes();
  } else {
    alert("Erro: "+json.mensagem);
  }
}




// ==========================================================
// âœ” COLETAR PRESENTE
// ==========================================================
async function coletarPresente(idAdocao){
  if(!confirm("Confirmar que o presente foi COLETADO no ponto?")) return;

  const r = await fetch("/api/logistica", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      acao:"coletar",
      id_registro:idAdocao,    
      responsavel:"Admin",
      observacoes:""
    })
  });

  const json = await r.json();

  if(json.sucesso){
    alert("Presente marcado como ENTREGUE!");
    carregarAdoacoes();
  } else {
    alert("Erro: "+json.mensagem);
  }
}



document.addEventListener("DOMContentLoaded", carregarAdoacoes);

</script>

</body>
</html>
