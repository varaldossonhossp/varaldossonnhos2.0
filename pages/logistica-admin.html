<!-- //---------------------------------------------
// üíô VARAL DOS SONHOS ‚Äî pages/logistica-admin.html
// ------------------------------------------------------------
// P√°gina do painel administrativo para gerenciar a log√≠stica
// das doa√ß√µes: confirma√ß√£o de ado√ß√µes e envio de e-mails.
//     Painel para gerenciar a log√≠stica das doa√ß√µes:
//     ‚Ä¢ Aguardando confirma√ß√£o
//     ‚Ä¢ Aguardando receber
//     ‚Ä¢ Aguardando coletar
//=========================================================== -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üì¶ Log√≠stica das Doa√ß√µes | Varal dos Sonhos</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonte padr√£o -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="icon" href="../imagens/favicon.png" />

  <style>
    body { font-family: "Poppins", sans-serif; background:#e3f2fd; }

    /* Sidebar exclusiva da log√≠stica */
    .sidebar {
      width: 270px;
      background: #1565c0;
      color: white;
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      padding: 20px 0;
      box-shadow: 3px 0px 10px rgba(0,0,0,0.15);
    }

    .sidebar h2 {
      padding-left: 28px;
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 30px;
    }

    .sidebar a {
      display: block;
      padding: 14px 30px;
      margin: 4px 0;
      text-decoration: none;
      color: white;
      font-weight: 500;
      transition: .2s;
    }
    .sidebar a:hover {
      background: #1e88e5;
      padding-left: 40px;
    }

    /* √Årea da direita */
    .content {
      margin-left: 290px;
      padding: 40px;
    }

    .card {
      background: white;
      padding: 25px;
      border-radius: 18px;
      margin-bottom: 40px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }

    .card-item {
      background:white;
      border-radius: 14px;
      padding: 20px;
      border: 1px solid #d0e2ff;
      margin-bottom: 16px;
    }

    .tag{
      background:#e3f2fd;
      padding:4px 10px;
      border-radius:8px;
      font-size:13px;
      margin-right:4px;
      color:#0d47a1;
    }

    .btn-blue{
      background:#1e88e5;color:white;padding:10px 16px;border-radius:10px;
      font-weight:600;
    }
    .btn-green{
      background:#2e7d32;color:white;padding:10px 16px;border-radius:10px;
      font-weight:600;
    }
    .btn-orange{
      background:#ef6c00;color:white;padding:10px 16px;border-radius:10px;
      font-weight:600;
    }
  </style>
</head>

<body>

<!-- ==========================================================
     üìå SIDEBAR EXCLUSIVA DA LOG√çSTICA
=========================================================== -->
<aside class="sidebar">
  <h2>üì¶ Log√≠stica</h2>

  <a href="#sec-pendentes">‚è≥ Aguardando Confirma√ß√£o</a>
  <a href="#sec-confirmadas">üì¨ Aguardando Receber</a>
  <a href="#sec-coletar">üöö Aguardando Coletar</a>

  <hr class="my-6 border-white/40">

  <a href="admin.html">‚¨ÖÔ∏è Voltar ao Painel Admin</a>
  <a href="../index.html">üè† Voltar ao Site</a>
</aside>


<!-- ==========================================================
     üìå CONTE√öDO PRINCIPAL
=========================================================== -->
<main class="content">

  <h1 class="text-3xl font-bold text-blue-800 mb-6">
    üì¶ Log√≠stica das Doa√ß√µes
  </h1>

  <!-- ======================================================
       1 ‚Äî AGUARDANDO CONFIRMA√á√ÉO
  ====================================================== -->
  <section id="sec-pendentes" class="card">
    <h2 class="text-2xl font-bold text-blue-600 mb-4">‚è≥ Aguardando Confirma√ß√£o</h2>
    <div id="cardsPendentes"></div>
  </section>

  <!-- ======================================================
       2 ‚Äî AGUARDANDO RECEBER
  ====================================================== -->
  <section id="sec-confirmadas" class="card">
    <h2 class="text-2xl font-bold text-green-700 mb-4">üì¨ Aguardando Receber</h2>
    <div id="cardsConfirmadas"></div>
  </section>

  <!-- ======================================================
       3 ‚Äî AGUARDANDO COLETAR
  ====================================================== -->
  <section id="sec-coletar" class="card">
    <h2 class="text-2xl font-bold text-orange-700 mb-4">üöö Aguardando Coletar</h2>
    <div id="cardsColetar"></div>
  </section>

</main>

<!-- ==========================================================
     SCRIPT DE L√ìGICA
=========================================================== -->
<script src="../js/config-site-apply.js"></script>

<script>

async function carregarAdoacoes(){
  const c1 = document.getElementById("cardsPendentes");
  const c2 = document.getElementById("cardsConfirmadas");
  const c3 = document.getElementById("cardsColetar");

  c1.innerHTML = c2.innerHTML = c3.innerHTML = "<p>Carregando...</p>";

  const r = await fetch("/api/listAdocoes");
  const { sucesso, adocoes } = await r.json();

  if(!sucesso){ alert("Erro ao carregar ado√ß√µes."); return; }

  const pendentes  = adocoes.filter(a => a.status_adocao === "aguardando confirmacao");
  const confirmadas = adocoes.filter(a => a.status_adocao === "confirmada");
  const coletar     = adocoes.filter(a => a.status_adocao === "presente recebido");

  // -------- PENDENTES --------
  c1.innerHTML = pendentes.length ? "" : "<p class='text-gray-600'>Nenhuma ado√ß√£o pendente.</p>";
  pendentes.forEach(a=>{
    c1.innerHTML += `
      <div class="card-item">
        <p class="font-bold text-lg">${a.nome_crianca}</p>
        <p class="text-gray-600 text-sm">üéÅ ${a.sonho}</p>

        <div class="mt-2">
          <span class="tag">üÜî Cartinha: ${a.id_cartinha}</span>
          <span class="tag">üë§ ${a.nome_usuario}</span>
        </div>

        <button class="btn-blue mt-4" onclick="confirmarAdocao('${a.id_record}')">
          ‚úî Confirmar
        </button>
      </div>
    `;
  });

  // -------- CONFIRMADAS --------
  c2.innerHTML = confirmadas.length ? "" : "<p class='text-gray-600'>Nenhuma ado√ß√£o confirmada.</p>";
  confirmadas.forEach(a=>{
    c2.innerHTML += `
      <div class="card-item">
        <p class="font-bold text-lg">${a.nome_crianca}</p>
        <p class="text-gray-600 text-sm">üéÅ ${a.sonho}</p>

        <div class="mt-2">
          <span class="tag">üÜî Cartinha: ${a.id_cartinha}</span>
          <span class="tag">üì¶ Ponto: ${a.nome_ponto || "‚Äî"}</span>
        </div>

        <button class="btn-green mt-4"
          onclick="receberPresente('${a.id_record}', '${a.id_ponto}')">
          üì¶ Recebido
        </button>
      </div>
    `;
  });

  // -------- COLETAR --------
  c3.innerHTML = coletar.length ? "" : "<p class='text-gray-600'>Nenhum presente aguardando coleta.</p>";
  coletar.forEach(a=>{
    c3.innerHTML += `
      <div class="card-item">
        <p class="font-bold text-lg">${a.nome_crianca}</p>
        <p class="text-gray-600 text-sm">üéÅ ${a.sonho}</p>

        <div class="mt-2">
          <span class="tag">üÜî Cartinha: ${a.id_cartinha}</span>
          <span class="tag">üì¶ Ponto: ${a.nome_ponto || "‚Äî"}</span>
        </div>

        <button class="btn-orange mt-4"
          onclick="coletarPresente('${a.id_record}', '${a.id_ponto}')">
          üöö Coletado
        </button>
      </div>
    `;
  });

}



// ==========================================================
// ‚úî CONFIRMAR ADO√á√ÉO
// ==========================================================
async function confirmarAdocao(id){
  if(!confirm("Confirmar ado√ß√£o?")) return;

  const r = await fetch("/api/confirmar?id_adocao="+id);

  if(r.ok){
    alert("Ado√ß√£o confirmada!");
    carregarAdoacoes();
  } else {
    alert("Erro ao confirmar.");
  }
}



// ==========================================================
// ‚úî RECEBER PRESENTE (PONTO)
// ==========================================================
async function receberPresente(idAdocao, idPonto){
  if(!confirm("Confirmar que o presente foi RECEBIDO no ponto?")) return;

  const r = await fetch("/api/logistica", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      acao:"receber",
      id_adocao:idAdocao,
      id_ponto:idPonto,
      responsavel:"Admin",
      observacoes:""
    })
  });

  const json = await r.json();

  if(json.sucesso){
    alert("Presente marcado como RECEBIDO!");
    carregarAdoacoes();
  } else {
    alert("Erro: "+json.mensagem);
  }
}



// ==========================================================
// ‚úî COLETAR PRESENTE
// ==========================================================
async function coletarPresente(idAdocao, idPonto){
  if(!confirm("Confirmar que o presente foi COLETADO no ponto?")) return;

  const r = await fetch("/api/logistica", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      acao:"coletar",
      id_adocao:idAdocao,
      id_ponto:idPonto,
      responsavel:"Admin",
      observacoes:""
    })
  });

  const json = await r.json();

  if(json.sucesso){
    alert("Presente marcado como ENTREGUE!");
    carregarAdoacoes();
  } else {
    alert("Erro: "+json.mensagem);
  }
}



document.addEventListener("DOMContentLoaded", carregarAdoacoes);

</script>

</body>
</html>
