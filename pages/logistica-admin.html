  <!--
// ---------------------------------------------
// ğŸ’™ VARAL DOS SONHOS â€” pages/logistica-admin.html
// ------------------------------------------------------------
// PÃ¡gina do painel administrativo para gerenciar a logÃ­stica
// das doaÃ§Ãµes: confirmaÃ§Ã£o de adoÃ§Ãµes e envio de e-mails.
// ============================================================  
-->

<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ“¦ LogÃ­stica das DoaÃ§Ãµes | Painel Administrativo</title>

  <!-- Framework visual TailwindCSS (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonte padrÃ£o do sistema -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <!-- Ãcone da aba -->
  <link rel="icon" href="../imagens/favicon.png" />

  <style>
    /* Estilos globais do painel */
    body { font-family: "Poppins", sans-serif; background:#e3f2fd; }

    /* Barra lateral fixa */
    .sidebar {
      width: 240px; background:#4086d6; color:white; height:100vh;
      position:fixed; top:0; left:0; display:flex; flex-direction:column;
      justify-content:space-between; box-shadow:2px 0 6px rgba(0,0,0,0.1);
    }

    .menu a {
      padding:12px 20px; display:block;
      color:white; text-decoration:none;
    }
    .menu a:hover { background:#64b5f6; }

    /* Ãrea de conteÃºdo Ã  direita */
    .content { margin-left:260px; padding:40px; }

    /* CartÃµes principais ("Aguardando" e "Confirmadas") */
    .card {
      background:white;
      padding:20px;
      border-radius:16px;
      box-shadow:0 3px 10px rgba(0,0,0,0.1);
    }

    /* CartÃµes individuais de cada adoÃ§Ã£o */
    .card-item {
      background:#fff;
      border:1px solid #dbeafe;
      border-radius:16px;
      padding:20px;
      margin-bottom:16px;
      box-shadow:0 2px 6px rgba(0,0,0,0.05);
    }

    /* BotÃµes personalizados */
    .btn-blue {
      background:#1e88e5; color:white;
      padding:10px 18px; border-radius:10px;
      font-weight:600; cursor:pointer;
    }

    .btn-green {
      background:#2e7d32; color:white;
      padding:10px 18px; border-radius:10px;
      font-weight:600; cursor:pointer;
    }

    /* Tags de informaÃ§Ãµes */
    .tag {
      background:#e3f2fd;
      padding:4px 10px;
      border-radius:8px;
      font-size:13px;
      color:#1e3a8a;
    }
  </style>
</head>

<body>

  <!-- ==========================================
       ğŸ“Œ SIDEBAR - Menu lateral do administrador
       ========================================== -->
  <aside class="sidebar">
    <div>
      <h2 class="text-xl font-bold p-6">âš™ï¸ Painel Admin</h2>

      <!-- Menu principal -->
      <nav class="menu">
        <a href="admin.html">ğŸ  InÃ­cio</a>
        <a href="logistica-admin.html">ğŸ“¦ LogÃ­stica das DoaÃ§Ãµes</a>
        <a href="cadastroevento.html">ğŸ‰ Eventos</a>
        <a href="cadastropontocoleta.html">ğŸ“¦ Pontos de Coleta</a>
        <a href="cadastrocartinha.html">ğŸ’Œ Cartinhas</a>
        <a href="relatorio-eventos.html">ğŸ—‚ï¸ RelatÃ³rios</a>
        <a href="gerenciargamificacao.html">ğŸ… GamificaÃ§Ã£o</a>
       </nav>
    </div>

    <!-- Voltar ao site -->
    <button onclick="window.location.href='../index.html'" class="m-4 p-3 rounded bg-white/20">
      â¬…ï¸ Voltar ao Site
    </button>
  </aside>



  <!-- ===================================================
       ğŸ“Œ CONTEÃšDO PRINCIPAL DO PAINEL
       =================================================== -->
  <main class="content">

    <h1 class="text-3xl font-bold text-blue-800 mb-6">ğŸ“¦ LogÃ­stica das DoaÃ§Ãµes</h1>
    <p class="text-gray-600 mb-6">
      Aqui vocÃª confirma adoÃ§Ãµes e acompanha o recebimento dos presentes ğŸ’™
    </p>


    <!-- =============================
         SEÃ‡ÃƒO 1 â€” Aguardando
         ============================= -->
    <section class="card mb-10">
      <h2 class="text-2xl font-semibold text-blue-700 mb-4">
        â³ AdoÃ§Ãµes aguardando confirmaÃ§Ã£o
      </h2>

      <!-- Onde os cartÃµes serÃ£o carregados via JS -->
      <div id="cardsAguardando"></div>
    </section>


    <!-- =============================
         SEÃ‡ÃƒO 2 â€” Confirmadas
         ============================= -->
    <section class="card">
      <h2 class="text-2xl font-semibold text-green-700 mb-4">
        âœ… AdoÃ§Ãµes confirmadas
      </h2>

      <!-- Onde os cartÃµes serÃ£o carregados via JS -->
      <div id="cardsConfirmadas"></div>
    </section>

  </main>



<!-- ======================================================
     ğŸ“Œ SCRIPT JS â€” Carregar adoÃ§Ãµes e aplicar aÃ§Ãµes
     ====================================================== -->
<script>

/* ----------------------------------------------
   ğŸ”„ FunÃ§Ã£o principal: busca todas as adoÃ§Ãµes
   via API `/api/listAdocoes.js`
   ---------------------------------------------- */
async function carregarAdoacoes() {

  const c1 = document.getElementById("cardsAguardando");
  const c2 = document.getElementById("cardsConfirmadas");

  c1.innerHTML = "<p>Carregando...</p>";
  c2.innerHTML = "<p>Carregando...</p>";

  try {
    // API que retorna todas adoÃ§Ãµes e seus dados resumidos
    const r = await fetch("/api/listAdocoes");
    const json = await r.json();

    if (!json.sucesso) {
      alert("Erro ao carregar adoÃ§Ãµes.");
      return;
    }

    const lista = json.adocoes || [];

    // Filtrar adoÃ§Ãµes por status
    const pendentes = lista.filter(a => a.status_adocao === "aguardando confirmacao");
    const confirmadas = lista.filter(a => a.status_adocao === "confirmada");



    /* ---------------------------
       SEÃ‡ÃƒO 1 â€” Pendentes
       --------------------------- */
    c1.innerHTML = "";
    if (pendentes.length === 0)
      c1.innerHTML = `<p class="text-gray-500">Nenhuma adoÃ§Ã£o pendente.</p>`;

    pendentes.forEach(a => {
      c1.innerHTML += `
        <div class="card-item">

          <p class="font-semibold text-blue-900 text-lg">${a.nome_crianca}</p>
          <p class="text-sm text-gray-600">ğŸ ${a.sonho}</p>

          <!-- Tags com informaÃ§Ãµes resumidas -->
          <div class="mt-2">
            <span class="tag">ğŸ†” Cartinha: ${a.id_cartinha}</span>
            <span class="tag">ğŸ‘¤ Doador: ${a.nome_usuario || "â€”"}</span>
            <span class="tag">ğŸ“¦ Ponto: ${a.nome_ponto || "â€”"}</span>
          </div>

          <!-- BotÃ£o azul para confirmar adoÃ§Ã£o -->
          <button class="btn-blue mt-4"
            onclick="confirmarAdoÃ§Ã£o('${a.id_record}')">
            Confirmar adoÃ§Ã£o
          </button>

        </div>
      `;
    });



    /* ---------------------------
       SEÃ‡ÃƒO 2 â€” Confirmadas
       --------------------------- */
    c2.innerHTML = "";
    if (confirmadas.length === 0)
      c2.innerHTML = `<p class="text-gray-500">Nenhuma adoÃ§Ã£o confirmada.</p>`;

    confirmadas.forEach(a => {
      c2.innerHTML += `
        <div class="card-item">

          <p class="font-semibold text-green-900 text-lg">${a.nome_crianca}</p>
          <p class="text-sm text-gray-600">ğŸ ${a.sonho}</p>

          <div class="mt-2">
            <span class="tag">ğŸ†” Cartinha: ${a.id_cartinha}</span>
            <span class="tag">ğŸ“¦ Ponto: ${a.nome_ponto || "â€”"}</span>
          </div>

          <!-- BotÃ£o verde para marcar como PRESENTE RECEBIDO -->
          <button class="btn-green mt-4"
            onclick="coletado('${a.id_record}')">
            Coletado
          </button>

        </div>
      `;
    });

  } catch (e) {
    console.error(e);
    alert("Erro ao carregar dados da logÃ­stica.");
  }
}




/* ---------------------------------------------------
   ğŸŸ¦ FunÃ§Ã£o â€” Confirmar AdoÃ§Ã£o (Admin)
   Chama a API `/api/confirmar?id_adocao=`
   --------------------------------------------------- */
async function confirmarAdoÃ§Ã£o(idAdocao) {

  if (!confirm("Confirmar adoÃ§Ã£o e enviar e-mail ao doador?")) return;

  const r = await fetch(`/api/confirmar?id_adocao=${idAdocao}`);

  if (!r.ok) {
    alert("Erro ao confirmar adoÃ§Ã£o.");
    return;
  }

  alert("AdoÃ§Ã£o confirmada com sucesso!");
  carregarAdoacoes();
}



/* ---------------------------------------------------
   ğŸŸ© FunÃ§Ã£o â€” Marcar presente como RECEBIDO
   Chama a API `/api/logistica` com acao="receber"
   --------------------------------------------------- */
async function coletado(idAdocao) {

  if (!confirm("Marcar como PRESENTE RECEBIDO?")) return;

  const r = await fetch("/api/logistica", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      acao: "receber",    // RECEBIMENTO de presente
      id_adocao: idAdocao,
      id_ponto: "1",      // em produÃ§Ã£o deve usar o real
      responsavel: "Admin do Sistema"
    })
  });

  if (!r.ok) {
    alert("Erro ao registrar coleta.");
    return;
  }

  alert("Presente marcado como RECEBIDO!");
  carregarAdoacoes();
}



/* ---------------------------------------------------
   Inicia carregamento automÃ¡tico ao abrir a pÃ¡gina
   --------------------------------------------------- */
document.addEventListener("DOMContentLoaded", carregarAdoacoes);

</script>

</body>
</html>
